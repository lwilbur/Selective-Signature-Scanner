#!/usr/bin/env python3
from os import listdir
from pyzipper import AESZipFile
import subprocess

malw_zip_dir = "malware_samples"
malw_zip_filenames = listdir("./malware_samples") 
malw_pw = b"infected"

def main():
    # Create folder to hold all the unzipped files
    unzip_dir = "malware_unzipped"
    subprocess.run(["mkdir", unzip_dir])

    # Handle each zipped file
    for malw_zip in malw_zip_filenames:
        # Read in the zip file
        with AESZipFile(f'{malw_zip_dir}/{malw_zip}', 'r') as zipfile:
            # Unencrypt and output using password
            zipfile.setpassword(malw_pw)
            zipfile.extractall(unzip_dir)

if __name__ == '__main__':
    main()
